<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name="generator" content=
    "HTML Tidy for HTML5 for Mac OS X version 5.4.0">
    <title>
      Tokenized Card Payment
    </title>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' async
    class='remove'></script>
    <script src='utils.js' class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          github: "https://github.com/w3c/webpayments-methods-tokenization/",
          shortName:  "tokenized-card",
          edDraftURI:   "https://w3c.github.io/webpayments-methods-tokenization/",
          specStatus: "unofficial",
          editors: [
                {
                    name:      "Keyur Patel",
                    company:   "Mastercard"
                },
                {   name:       "Kevin Hurley",
                    company:    "Facebook"
                },
                {
                    name:      "Roy McElmurry",
                    company:   "Facebook"
                }
          ],
          useExperimentalStyles: true,
         license:      "w3c-software-doc",
         wg:           "Web Payments Working Group",
         wgURI:        "https://www.w3.org/Payments/WG/",
         wgPublicList: "public-payments-wg",
         issueBase:    "https://github.com/w3c/webpayments-methods-tokenization/issues/",
        localBiblio: {
          "card-network-ids": {
            "href": "https://www.w3.org/Payments/card-network-ids",
            "publisher": "W3C",
            "title": "Card Network Identifiers Approved for use with Payment Request API"
          },
          "EMVCO-TOKENIZATION": {
            "href": "https://www.emvco.com/emv-technologies/payment-tokenisation/",
            "publisher": "EMVCo",
            "title": "EMV® Payment Tokenisation Specification – Technical Framework"
          },
          "EMVCO-3DS": {
            "href": "https://www.emvco.com/emv-technologies/3d-secure/",
            "publisher": "EMVCo",
            "title": "EMV® 3-D Secure"
          },
          "RESPONSE-DATA-ENCRYPTION": {
            "href": "https://github.com/w3c/webpayments-crypto/wiki/Encryption",
            "publisher": "W3C",
            "title": "Encryption (PROPOSAL)"
          }
        },
      };
    </script>
    <style>
    dt { margin-top: 0.75em; }
    table { margin-top: 0.75em; border-collapse:collapse; border-style:hidden hidden none hidden }
    table thead { border-bottom:solid }
    table tbody th:first-child { border-left:solid }
    table td, table th { border-left:solid; border-right:solid; border-bottom:solid thin; vertical-align:top; padding:0.2em }
    li { margin-top: 0.5em; margin-bottom: 0.5em;}
    </style>
  </head>
  <body>
    <section id="abstract">
      <p>
        This specification defines a Payment Method used by the PaymentRequest
        API [[!payment-request]] to support tokenized card payments.
      </p>
    </section>
    <section id='sotd'>
      <p>
        The working group maintains <a href=
        "https://github.com/w3c/webpayments-methods-tokenization/issues">a list
        of all bug reports that the group has not yet addressed</a>. Pull
        requests with proposed specification text for outstanding issues are
        strongly encouraged.
      </p>
    </section>
    <section class="informative">
      <h2>
        Introduction
      </h2>
      <p>
        This specification is a Payment Method Specification used by the
        PaymentRequest API [[!payment-request]] to support tokenized card
        payments. The tokens anticipated by this specification are "network" or
        "issuer" tokens.
      </p>
      <p class="issue" title="Drop the word 'card' from this payment method"
      data-number="27">
        The task force is discussing whether this payment method should be
        specific to network tokens for card payments, or more general-purpose.
      </p>
      <p>
        Payment networks such as Mastercard, Visa, and American Express provide
        tokenization services for credit cards and debit cards. The intention
        of tokenization is to ensure that a consumer's primary account number
        (PAN) is not exposed to potentially insecure merchant environments. To
        increase the security of payment processing, merchants —or their
        Payment Service Providers (PSPs)— may use tokens along with
        cryptographically generated dynamic data.
      </p>
      <p>
        This document describes a payment method that achieves the security
        goals of EMVCo tokenization specifications, within the usual Payment
        Request API flow. The payment handler achieves this by leveraging
        elements of [[EMVCO-TOKENIZATION]] and [[EMVCO-3DS]].
      </p>
    </section>
    <section id="exampleData">
      <h2>
        Examples
      </h2>
      <section>
        <h3>
          Request Example
        </h3>
        <pre class="example">
const methodData = [{
  supportedMethods: ["tokenized-card"],
  data: {
    supportedNetworks: ['mastercard','visa', 'amex', 'discover', 'jcb','unionpay'],
    supportedTypes: ['credit','debit'],
    keyProviderURL: 'https://pspKeyProvider.example/tokenizedCardPublicKey',
  }
}];

const details = {
  displayItems: [
    {
      label: "Sub-total",
      amount: { currency: "USD", value: "55.00" },
    },
    {
      label: "Sales Tax",
      amount: { currency: "USD", value: "5.00" },
    },
  ],
  total: {
    label: "Total due",
    // The total is USD$65.00 here because we need to
    // add shipping (below). The selected shipping
    // costs USD$5.00.  
    amount: { currency: "USD", value: "65.00" },
  },
};

new PaymentRequest(methodData, details);
        </pre>
      </section>
      <section>
        <h3>
          Response Example
        </h3>
        <p>
          This example shows some fictitious Mastercard-specific response data.
        </p>
        <div class="example">
          <pre>
          {
          displayLast4: "***6789",
          displayExpiryMonth: "02",
          displayExpiryYear: "22",
          displayNetwork: "mastercard",
          encryptedTokenizedCard: "QWxobHZ4bU4yWkt1QUFFU05GWjRHb0FCRkE9PQ==", 
          }
        </pre>
          <p>
            When decrypted, the <code>encryptedTokenizedCard</code> data would
            be:
          </p>
          <pre>
          {
          cardNumber: "5413339000001513",
          expiryMonth: "12",
          expiryYear: "20",
          cryptogram: "AlhlvxmN2ZKuAAESNFZ4GoABFA==",
          typeOfCryptogram: "UCAF", // "Universal Card Authentication Field"
          trid: "59812345678",
          eci: "242", // Authorization and final transaction request with UCAF data
          }
        </pre>
        </div>
      </section>
    </section>
    <section id="prerequisites">
      <h2>
        Payment Method Prerequisites
      </h2>
      <p>
        The following are prerequisites for using this payment method.
      </p>
      <ul>
        <li>A payment handler MUST be able to access the services of one or
        more <a>Token Service Providers</a>.
        </li>
      </ul>
    </section>
    <section id="method-id">
      <h2>
        Payment Method Identifier
      </h2>
      <p>
        The <a>payment method identifier</a> string for the Tokenized Card
        Payment method is <dfn><code>tokenized-card</code></dfn>.
      </p>
    </section>
    <section data-dfn-for="TokenizedCardRequest" data-link-for=
    "TokenizedCardRequest">
      <h2>
        <dfn>TokenizedCardRequest</dfn> dictionary
      </h2>
      <p>
        This section describes payment method specific data that is supplied as
        part of the <code>data</code> argument to the PaymentRequest
        constructor.
      </p>
      <p class="issue" title="Linkage to BasicCard Spec" data-number="17">
        The task force is still discussing whether this specification should
        include terms common to Basic Card by reference or redefine them in
        line.
      </p>
      <pre class="idl">
        dictionary TokenizedCardRequest{
          sequence&lt;DOMString&gt;       supportedNetworks;
          sequence&lt;BasicCardType&gt;        supportedTypes;
          required DOMString        keyProviderURL; 
        };
      </pre>
      <p>
        The <code>TokenizedCardRequest</code> dictionary contains the following
        members:
      </p>
      <dl>
        <dt>
          <dfn>supportedNetworks</dfn>
        </dt>
        <dd>
          A sequence of identifiers for card networks that the merchant
          accepts. W3C maintains a <a data-cite="card-network-ids">list of
          approved card network identifiers</a>.
        </dd>
        <dt>
          <dfn>supportedTypes</dfn>
        </dt>
        <dd>
          A card can be of type "credit", "debit", or "prepaid", as derived
          from the issuer identification number (the first eight digits of the
          <dfn data-cite="!ISO7812-1">primary account number</dfn> (PAN). The
          different types are represented as the <a>BasicCardType</a> enum.
        </dd>
        <dt>
          <dfn>keyProviderURL</dfn>
        </dt>
        <dd>
          This member designates, via a URL, a public key trusted by the
          <a>Token Service Provider</a>. The source of the key, therefore,
          becomes the effective requestor of the tokenized-card from a <a>Token
          Service Provider</a>'s perspective.
          <p class="issue" title=
          "What public key formats are acceptable, and any constraints?">
            See <a href=
            "https://github.com/w3c/webpayments-crypto/issues/1">What public
            key formats are acceptable, and any constraints? #1</a> .
          </p>
        </dd>
      </dl>
      <p class="issue" title="Token Properties for Matching" data-number="25">
      </p>
      <p class="issue" title="Multiuse Tokens" data-number="20"></p>
    </section>
    <section data-dfn-for="TokenizedCardResponse" data-link-for=
    "TokenizedCardResponse">
      <h2>
        <dfn>TokenizedCardResponse</dfn> dictionary
      </h2>
      <pre class="idl">
        dictionary TokenizedCardResponse {
                       DOMString       displayMaskedCard;
                       DOMString       displayLast4;
           required    DOMString       displayExpiryMonth;
           required    DOMString       displayExpiryYear; 
           required    DOMString       displayNetwork;
           required    EncryptedTokenizedCard encryptedTokenizedCard;
         };
      </pre>
      <dl>
        <dt>
          <dfn>displayLast4</dfn> member
        </dt>
        <dd>
          It is common for applications to want to display recognizable
          information about the user's card, without revealing sensitive
          credentials. This value may be used as a hint, for the common case of
          displaying the last four digits of the original PAN.
        </dd>
        <dt>
          <dfn>displayMaskedCard</dfn> member
        </dt>
        <dd>
          In some cases, the card issuer may provide an alternative hint to
          <a>displayLast4</a>. Applications MAY use either <a>displayLast4</a>
          or <a>displayMaskedCard</a> as a hint, and SHOULD use only one of
          them to avoid confusion or leaking information.
        </dd>
        <dt>
          <dfn>displayExpiryMonth</dfn> member
        </dt>
        <dd>
          A two-digit string for the actual expiry month of the card in the
          range "01" to "12".
        </dd>
        <dt>
          <dfn>displayExpiryYear</dfn> member
        </dt>
        <dd>
          A four-digit string for the expiry year of the actual card in the
          range "0000" to "9999".
        </dd>
        <dt>
          <dfn>displayNetwork</dfn> member
        </dt>
        <dd>
          The name of the actual <a>Payment Network</a> of the card.
        </dd>
        <dt>
          <dfn>encryptedTokenizedCard</dfn> member
        </dt>
        <dd>
          This member includes <a>EncryptedTokenizedCard</a> information.
        </dd>
      </dl>
      <section data-dfn-for="EncryptedTokenizedCard" data-link-for=
      "EncryptedTokenizedCard">
        <h2>
          <dfn>EncryptedTokenizedCard</dfn> dictionary
        </h2>
        <p>
          This dictionary represents data encrypted with the key identified by
          the <a data-lt=
          "TokenizedCardRequest.keyProviderURL">keyProviderURL</a> according to
          [[RESPONSE-DATA-ENCRYPTION]].
        </p>
        <p class="issue" title="Encryption Details" data-number="35"></p>
        <pre class="idl">
          dictionary EncryptedTokenizedCard {
           required DOMString       cardNumber;
           required DOMString       expiryMonth;
           required DOMString       expiryYear;
           required DOMString       cryptogram;
                    DOMString       typeOfCryptogram;
                    DOMString       trid;
                    DOMString       eci;
          };
        </pre>
        <dl>
          <dt>
            <dfn>cardNumber</dfn> member
          </dt>
          <dd>
            This member is a <a>Payment Token</a>.
          </dd>
          <dt>
            <dfn>expiryMonth</dfn> member
          </dt>
          <dd>
            A two-digit string of dynamic data in the range "01" to "12"; this
            does not represent the actual expiry month of the card.
          </dd>
          <dt>
            <dfn>expiryYear</dfn> member
          </dt>
          <dd>
            A four-digit string of dynamic data in the range "0000" to "9999";
            this does not represent the actual expiry year of the card.
          </dd>
          <dt>
            <dfn>cryptogram</dfn> member
          </dt>
          <dd>
            This member is a <a>Token Cryptogram</a>. It is <a>Payment
            Network</a>-specific and used to ensure the authenticity of the
            transaction.
          </dd>
          <dt>
            <dfn>typeOfCryptogram</dfn> member
          </dt>
          <dd>
            This member is a <a>Payment Network</a>-specific string that
            described the <a>cryptogram</a> type.
          </dd>
          <dt>
            <dfn>trid</dfn> member
          </dt>
          <dd>
            This member is a <a>Token Requestor ID</a>, an 11-digit numeric
            value set by the Token Service Provider.
          </dd>
          <dt>
            <dfn>eci</dfn> member
          </dt>
          <dd>
            This member is an <a>Electronic Commerce Indicator</a>, a
            <a>Payment Network</a>-specific string to indicate the results of
            user authentication.
          </dd>
        </dl>
      </section>
    </section>
    <section id="security">
      <h2>
        Security and Privacy Considerations
      </h2>
      <p class="issue" title="Document threat model" data-number="36"></p>
    </section>
    <section id="dependencies">
      <h2>
        Dependencies
      </h2>
      <p>
        This specification relies on several other underlying specifications.
      </p>
      <dl>
        <dt>
          Payment Request API
        </dt>
        <dd>
          The terms <dfn>PaymentAddress</dfn> and <dfn>PaymentRequest
          constructor</dfn> are defined in Payment Request API
          [[payment-request]].
        </dd>
        <dt>
          Payment Method Identifiers
        </dt>
        <dd>
          The term <dfn data-lt="payment method identifiers">payment method
          identifier</dfn> is defined by the Payment Method Identifier
          specification [[!payment-method-id]].
        </dd>
        <dt>
          Basic Card Payment
        </dt>
        <dd>
          The terms <dfn data-cite=
          "!payment-method-basic-card#method-id">basic-card</dfn> and
          <dfn data-cite=
          "!payment-method-basic-card#basiccardtype-enum">BasicCardType</dfn>
          are defined in [[!payment-method-basic-card]].
        </dd>
        <dt>
          EMVCo Tokenisation
        </dt>
        <dd>
          The terms <dfn data-cite="!EMVCO-TOKENIZATION">Payment Token</dfn>,
          <dfn data-cite="EMVCO-TOKENIZATION">Token Cryptogram</dfn>,
          <dfn data-lt="Payment Network" data-cite="EMVCO-TOKENIZATION">Payment
          Networks</dfn>, <dfn data-lt="Token Service Provider" data-cite=
          "EMVCO-TOKENIZATION">Token Service Providers</dfn>, <dfn data-cite=
          "EMVCO-TOKENIZATION">Token Requestor ID</dfn> and <dfn data-cite=
          "EMVCO-TOKENIZATION">Tokenized Payment Method Credentials</dfn> are
          defined in [[EMVCO-TOKENIZATION]].
        </dd>
        <dt>
          EMVCo 3-D Secure
        </dt>
        <dd>
          The terms <dfn data-cite="!EMVCO-3DS">Electronic Commerce
          Indicator</dfn> is defined in [[EMVCO-3DS]].
          <p class="issue" title="EMV-like Security" data-number="28">
            The fact of referencing 3D Secure here means that the data returned
            is not strictly defined by EMV Tokenization.
          </p>
        </dd>
        <dt>
          Response Data Encryption
        </dt>
        <dd>
          [[!RESPONSE-DATA-ENCRYPTION]] is a work in progress of the Web
          Payments Working Group.
        </dd>
      </dl>
    </section>
    <section id="tsp-considerations" class="informative">
      <h2>
        Appendix: Token Service Provider Considerations
      </h2>
      <p>
        The following <a>Token Service Provider</a> considerations are
        explicitly out of scope for this specification.
      </p>
      <ul>
        <li>Any requirement for a KeyProvider to register/onboard with a Token
        Service Provider, for example to establish cryptogram conventions or
        other program-specific requirements.
        </li>
      </ul>
      <p class="issue" title="Out-of-band provisioning" data-number="32"></p>
      <p class="issue" title="Key Provider Registration" data-number="31"></p>
    </section>
    <section id="flow">
      <h2>
        Appendix: Flow Diagrams
      </h2>
      <p>
        <img alt="Tokenized card payment flow" width="100%" src=
        "https://w3c.github.io/webpayments-methods-tokenization/diagrams/tokenization3.png">
      </p>
      <p class="issue" title=
      "Where does tokenisation occur in the the flow - and do we care"
      data-number="16"></p>
    </section>
    <section id="acks">
      <h2>
        Acknowledgments
      </h2>
      <p>
        Thanks to Manash Bhattacharjee for his work on this specification.
      </p>
    </section>
  </body>
</html>
